$def with (kwargs)
<!DOCTYPE HTML>
<html>
<head>
	<title>Sabra-Wang's Clearance Interval Database</title>
	<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no' />
	<meta charset='UTF-8' />
	<script type='text/javascript' src='http://maps.googleapis.com/maps/api/js?key=AIzaSyAWXZXhG-0Hltuxf0CSwjZjf164WwnDFCE&sensor=false&libraries=geometry'></script>
	<script type='text/javascript'>
		var map;
		var latlng = new google.maps.LatLng($kwargs['map_lat'], $kwargs['map_lng']);

		function initialize()
		{
			var length;
			var initOptions = {
				center: latlng,
				zoom: $kwargs['map_zoom'],
				mapTypeId: google.maps.MapTypeId.HYBRID
			};
			map = new google.maps.Map(document.getElementById('map_canvas'), initOptions);
			yar_length = drawLine('$kwargs['p1_yar_line']', '#ff0000');
			fdw_length = drawLine('$kwargs['p1_fdw_line']', '#fff000');
			updateTable('p1', yar_length, fdw_length, '$kwargs['p1_grade']', '$kwargs['p1_speed']', '$kwargs['p1_mov']');
			//'#0000ff' blue
			//'#00ff00' green
			//'#ff00ff' purple
		}

		function drawLine(latlng_txt, color)
		{
			if(!latlng_txt)
			{
				return 0;
			}
			var path = createPath(latlng_txt);
			var polyOptions = {
					path: path,
					fillOpacity: 1,
					strokeWeight: 3,
					strokeColor: color
			};
			var line = new google.maps.Polyline(polyOptions);
			var position = google.maps.geometry.spherical.interpolate(path.getAt(0), path.getAt(1), .5);
			var length = google.maps.geometry.spherical.computeLength(path) * 3.28;
			var txt_length = length.toFixed(0).toString() + "\'";
			var text = new textOverlay(position, txt_length, map);
			line.setMap(map);
			var poly = new google.maps.Polyline(polyOptions);
			poly.setMap(map);
			return length;
		}

		function createPath(latlng_txt)
		{
			var path = new google.maps.MVCArray();
			for(index=0; index<2; index++)
			{
				coordinate = latlng_txt.split('+')[index];
				coordinate = coordinate.split('(')[1];
				coordinate = coordinate.split(')')[0];
				lat = coordinate.split(', ')[0];
				lng = coordinate.split(', ')[1];
				path.push(new google.maps.LatLng(parseFloat(lat), parseFloat(lng)));
			}
			return path;
		}

		function textOverlay(latlng, text, map)
		{
			this.latlng_ = latlng;
			this.text_ = text;
			this.map_ = map;
			this.div_ = null;
			this.setMap(map);
		}

		function updateTable(elem_id, yar_length, fdw_length, grade, speed, mov);
		{
			var yellow = calculateYellow(yar_length, speed, grade);
			var red = calculateRed(yar_length, speed, mov);
			var fdw = calculateFDW(fdw_length, red);
			document.getElementById(elem_id + '_y').innerHTML = yellow;
			document.getElementById(elem_id + '_r').innerHTML = red;
			document.getElementById(elem_id + '_f').innerHTML = fdw;
		}

		function calculateFDW(length, red)
		{
			if(length==0)
			{
				return 0;
			}
			var pct = length/3.5;
			return Math.ceil(pct - Math.max(red, 3));
		}

		function calculateYellow(length, speed, grade)
		{
			if(length==0)
			{
				return 0;
			}
			var yellow = 1 + (0.733*speed)/(10 + (0.32*grade));
			yellow = Math.max(yellow, 4.0);
			yellow = Math.min(yellow, 6.0);
			yellow = roundUpToHalf(yelow);
			return yellow;
		}

		function calculateRed(length, speed, mov)
		{
			if(length==0)
			{
				return 0;
			}
			var red = length/speed;
			if(mov=='Turn')
			{
				red = max(red, 0.5);
			}
			else
			{
				red = max(red, 1.0);
			}
			var rounded = roundDownToHalf(red);
			if((red-rounded)<=0.1)
			{
				return rounded;
			}
			return red;
		}

		function roundDownToHalf(value)
		{ 
			var down = Math.floor(value);
			var rem = value - down;
			if(rem >= 0.5)
			{
				return down + 0.5;
			}
			return down;
		}

		function roundUpToHalf(value)
		{ 
			var up = Math.ceil(value);
			var rem = up - value;
			if(rem >= 0.5)
			{
				return up - 0.5;
			}
			return up;
		}

		textOverlay.prototype = new google.maps.OverlayView();

		textOverlay.prototype.onAdd = function()
		{
			var div = document.createElement('DIV');
			div.style.border = 'none';
			div.style.borderWidth = '0px';
			div.style.position = 'absolute';
			div.style.color = '#000000';
			div.style.fontWeight = 'bold';
			div.style.fontSize = '18px';
			div.style.backgroundColor = '#ffffff';
			div.innerHTML = this.text_;
			this.div_ = div;
			var panes = this.getPanes();
			panes.floatPane.appendChild(div);
		}
		textOverlay.prototype.draw = function()
		{
			var overlayProjection = this.getProjection();
			var position = overlayProjection.fromLatLngToDivPixel(this.latlng_);
			var div = this.div_;
			div.style.left = position.x +'px';
			div.style.top = position.y + 'px';
		}
	</script>
</head>
<body onload='initialize()'>
	<a href='http://localhost:8080'>Go Home</a>
	<p style='margin-bottom:10px;text-align:center;font-size:36px;font-weight:bold'>$kwargs['int_id'] - $kwargs['major'] and $kwargs['minor']</p>
	<div id='map_canvas' style='margin:auto;width:600px;height:600px'></div>
	<table style='margin:auto;font-size:20px' border='1'>
		<tr>
			<td />
			<td colspan='8'><b>PHASE NUMBER</b></td>
		<tr>
			<td />
			<td><b>1</b></td>
			<td><b>2</b></td>
			<td><b>3</b></td>
			<td><b>4</b></td>
			<td><b>5</b></td>
			<td><b>6</b></td>
			<td><b>7</b></td>
			<td><b>8</b></td>
		</tr>
		<tr>
			<td><b>Yellow (Y)</b></td>
			<td id='p1_y'></td>
			<td id='p2_y'></td>
			<td id='p3_y'></td>
			<td id='p4_y'></td>
			<td id='p5_y'></td>
			<td id='p6_y'></td>
			<td id='p7_y'></td>
			<td id='p8_y'></td>
		</tr>
		<tr>
			<td><b>All-Red (AR)</b></td>
			<td id='p1_r'></td>
			<td id='p2_r'></td>
			<td id='p3_r'></td>
			<td id='p4_r'></td>
			<td id='p5_r'></td>
			<td id='p6_r'></td>
			<td id='p7_r'></td>
			<td id='p8_r'></td>
		</tr>
		<tr>
			<td><b>Flashing Don't Walk (FDW)</b></td>
			<td id='p1_f'></td>
			<td id='p2_f'></td>
			<td id='p3_f'></td>
			<td id='p4_f'></td>
			<td id='p5_f'></td>
			<td id='p6_f'></td>
			<td id='p7_f'></td>
			<td id='p8_f'></td>
		</tr>
	</table>
</form>
</body>
</html>
